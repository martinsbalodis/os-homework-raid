<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link href="style.css" rel="stylesheet" type="text/css">
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="raid.js"></script>
	</head>
	<body>
		Sektors: <input type="text" id="write_sector" value="0" maxLength="1">
		Vērtība: <input type="text" id="data" value="A" maxLength="1">
		<button id="write">Rakstīt</button>
		<br>
		Sektors: <input type="text" id="read_sector" value="0">
		<button id="read">Lasīt sektoru</button>
		<br>
	</body>
</html>
<script>

//window.root = new Raid({
//	id:'RAID1',
//	type:'R1',
//	children:[
//		new Disk({
//			id:'disk1',
//			size:3
//		}),
//		new Disk({
//			id:'disk2',
//			size:3
//		}),
//		new Raid({
//			id:'RAID1',
//			type:'R0',
//			children:[
//				new Disk({
//					id:'disk3',
//					size:3
//				}),
//				new Disk({
//					id:'disk4',
//					size:3
//				}),
//				new Disk({
//					id:'disk5',
//					size:3
//				}),
//			]
//		})
//	]
//});

//window.raid10 = new Raid({
//	id:'RAID0',
//	type:'R0',
//	children:[
//		new Raid({
//			id:'RAID1',
//			type:'R1',
//			children:[
//				new Disk({
//					id:'disk1',
//					size:3
//				}),
//				new Disk({
//					id:'disk2',
//					size:3
//				}),
//			]
//		}),
//		new Raid({
//			id:'RAID1',
//			type:'R1',
//			children:[
//				new Disk({
//					id:'disk3',
//					size:3
//				}),
//				new Disk({
//					id:'disk4',
//					size:3
//				}),
//			]
//		})
//	]
//})

//window.raid5 = new Raid({
//	id:'RAID5',
//	type:'R5',
//	children:[
//		new Disk({
//			id:'disk1',
//			size:3
//		}),
//		new Disk({
//			id:'disk2',
//			size:3
//		}),
//		new Disk({
//			id:'disk3',
//			size:3
//		}),
//	]
//});

window.crazyRaid = new Raid({
	id:'RAID5',
	type:'R5',
	children:[
		new Disk({
			id:'disk1',
			size:3
		}),
		new Raid({
			id:'RAID0',
			type:'R0',
			children:[
				new Disk({
					id:'A',
					size:3
				}),
				new Disk({
					id:'B',
					size:3
				}),
				new Disk({
					id:'C',
					size:3
				}),
			]
		}),
		new Raid({
			id:'RAID1',
			type:'R1',
			children:[
				new Disk({
					id:'disk1',
					size:3
				}),
				new Disk({
					id:'disk2',
					size:3
				}),
			]
		})
	]
});


window.root = window.crazyRaid;

var width = 700,
    height = 700;

var cluster = d3.layout.cluster()
    .size([height, width - 160]);

var diagonal = d3.svg.diagonal()
    .projection(function(d) { return [d.x, d.y]; });

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(0,40)");

var nodes = cluster.nodes(root),
	links = cluster.links(nodes);

var link = svg.selectAll(".link")
	.data(links)
  .enter().append("path")
	.attr("class", "link")
	.attr("d", diagonal);

var node = svg.selectAll(".node")
	.data(nodes)
  .enter().append("g")
	.attr("class", "node")
	.attr("transform", function(d) { 
		d.el = this;
		return "translate(" + d.x + "," + d.y + ")"; 
	});

node.append("circle")
	.attr("r", 10)
	.on("click", function(d,i) { 
		d.toggle();
	});

node.append("text")
	.attr("dx", function(d) { return d.children ? -12 : 12; })
	.attr("dy", 3)
	.style("text-anchor", function(d) { return d.children ? "end" : "start"; })
	.text(function(d) { 
		d.text_node = this;
		return d.text(); 
	});


d3.select(self.frameElement).style("height", height + "px");

document.getElementById('write').onclick = function(){
	var value = document.getElementById('data').value;
	var write_sector = parseInt(document.getElementById('write_sector').value);
	root.write(write_sector, value);
	return false;
}

document.getElementById('read').onclick = function(){
	var read_sector = parseInt(document.getElementById('read_sector').value);
	root.read(read_sector, function(data){
		console.log(data);
	});
	return false;
}

setTimeout(function(){root.write(0, "A");}, 100);
setTimeout(function(){root.write(1, "B");}, 200);
setTimeout(function(){root.write(2, "C");}, 300);
setTimeout(function(){root.write(3, "D");}, 400);
setTimeout(function(){root.write(4, "E");}, 500);
setTimeout(function(){root.write(5, "F");}, 600);

</script>
