<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link href="style.css" rel="stylesheet" type="text/css">
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="raid.js"></script>
	</head>
	<body>
		<input type="text" id="data" value="A" maxLength="1">
		<button id="write">Rakstīt</button>
		<br>
		<input type="text" id="read_sector" value="0">
		<button id="read">Lasīt sektoru</button>
		<br>
	</body>
</html>
<script>

root = new Raid({
	id:'RAID1',
	type:'R1',
	children:[
		new Disk({
			id:'disk1',
			size:10
		}),
		new Disk({
			id:'disk2',
			size:10
		}),
		new Raid({
			id:'RAID1',
			type:'R1',
			children:[
				new Disk({
					id:'disk3',
					size:10
				}),
				new Disk({
					id:'disk4',
					size:10
				}),

			]
		})
	]
});

var width = 500,
    height = 500;

var cluster = d3.layout.cluster()
    .size([height, width - 160]);

var diagonal = d3.svg.diagonal()
    .projection(function(d) { return [d.x, d.y]; });

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(0,40)");

var nodes = cluster.nodes(root),
	links = cluster.links(nodes);

var link = svg.selectAll(".link")
	.data(links)
  .enter().append("path")
	.attr("class", "link")
	.attr("d", diagonal);

var node = svg.selectAll(".node")
	.data(nodes)
  .enter().append("g")
	.attr("class", "node")
	.attr("transform", function(d) { 
		d.el = this;
		return "translate(" + d.x + "," + d.y + ")"; 
	});

node.append("circle")
	.attr("r", 10)
	.on("click", function(d,i) { 
		d.toggle();
		console.log(d3.select(this));
		if(d.enabled) {
			d3.select(this).classed("enabled", true);
			d3.select(this).classed("disabled", false);
		}
		else {
			d3.select(this).classed("enabled", false);
			d3.select(this).classed("disabled", true);
		}
	});

node.append("text")
	.attr("dx", function(d) { return d.children ? -8 : 8; })
	.attr("dy", 3)
	.style("text-anchor", function(d) { return d.children ? "end" : "start"; })
	.text(function(d) { 
		d.text_node = this;
		return d.id; 
	});


d3.select(self.frameElement).style("height", height + "px");

document.getElementById('write').onclick = function(){
	var value = document.getElementById('data').value;
	root.write(value);
	return false;
}

document.getElementById('read').onclick = function(){
	var read_sector = parseInt(document.getElementById('read_sector').value);
	root.read(read_sector, function(data){
		console.log(data);
	});
	return false;
}

setTimeout(function(){root.write("A");}, 100);
setTimeout(function(){root.write("B");}, 600);
setTimeout(function(){root.write("C");}, 1200);

</script>
